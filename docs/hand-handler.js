window.addEventListener("DOMContentLoaded",()=>{h(),f(),g()});const s=document.getElementById("dropzone"),r=document.getElementById("hand");s.addEventListener("dragover",e=>{e.preventDefault(),s.style.background="#ccf"});s.addEventListener("dragleave",()=>{s.style.background="transparent"});s.addEventListener("drop",async e=>{if(e.preventDefault(),s.style.background="transparent",n)r.removeChild(n),n=null;else if(e.dataTransfer.files&&e.dataTransfer.files.length)for(const t of e.dataTransfer.files){if(!t.type.startsWith("image/"))continue;const d=URL.createObjectURL(t),a=document.createElement("img");a.src=d,a.classList.add("card"),r.appendChild(a)}c()});document.addEventListener("click",e=>{const t=!!document.body.querySelector(".preview"),d=e.target.closest(".card");if(!t&&d){d.classList.add("hidden"),document.body.classList.add("preview-open");const a=document.createElement("div");a.classList.add("preview");const o=d.cloneNode(!0);o.style.setProperty("--angle","0deg"),o.style.marginLeft="0",o.classList.remove("hidden"),a.appendChild(o),document.body.appendChild(a)}else if(t){const a=document.body.querySelector(".preview");a&&a.remove();const o=r.querySelector(".card.hidden");o&&o.classList.remove("hidden"),document.body.classList.remove("preview-open")}});function f(){const e=Array.from(document.querySelectorAll("#hand .card")),t=e.length;if(!t)return;const d=30,a=t>1?-d/2:0,o=t>1?d/(t-1):0;e.forEach((l,i)=>{const u=a+o*i;l.style.setProperty("--angle",`${u}deg`),l.style.zIndex=i+1})}r.addEventListener("dragover",e=>{e.preventDefault(),e.target===r&&n&&(r.classList.add("drag-over-left"),e.dataTransfer.dropEffect="move")});r.addEventListener("dragleave",e=>{e.target===r&&r.classList.remove("drag-over-left")});r.addEventListener("drop",e=>{e.preventDefault(),r.classList.remove("drag-over-left"),e.target===r&&n&&(r.insertBefore(n,r.firstChild),c())});let n=null;function g(){r.querySelectorAll(".card").forEach(t=>{t.dataset.reorderable||(t.dataset.reorderable="true",t.setAttribute("draggable",!0),t.addEventListener("dragstart",v),t.addEventListener("dragover",p),t.addEventListener("dragleave",m),t.addEventListener("drop",L),t.addEventListener("dragend",y))})}function v(e){n=e.currentTarget,n.classList.add("dragging"),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain","")}function p(e){e.preventDefault();const t=e.currentTarget;t!==n&&(t.classList.add("drag-over"),e.dataTransfer.dropEffect="move")}function m(e){e.currentTarget.classList.remove("drag-over")}function L(e){e.preventDefault();const t=e.currentTarget;if(t.classList.remove("drag-over"),n&&t!==n){const d=t.nextSibling;r.insertBefore(n,d),c()}}function y(e){n&&(n.classList.remove("dragging"),n=null),r.querySelectorAll(".drag-over").forEach(t=>t.classList.remove("drag-over"))}function E(){const e=Array.from(r.querySelectorAll(".card")).map(t=>t.src);localStorage.setItem("cardHand",JSON.stringify(e))}function h(){const e=localStorage.getItem("cardHand");if(e)try{JSON.parse(e).forEach(d=>{const a=document.createElement("img");a.src=d,a.classList.add("card"),r.appendChild(a)})}catch(t){console.error("Failed to load hand from localStorage",t)}}function c(){f(),g(),E()}
